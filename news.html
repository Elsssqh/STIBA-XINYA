<!DOCTYPE html>
<html lang="zh-CN" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>News - STIBA 达国新雅学院</title>

  <script src="https://cdn.tailwindcss.com"></script>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Zhi+Mang+Xing&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,600;0,700;1,400&display=swap" rel="stylesheet">

  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            sans: ['"Noto Sans SC"', 'sans-serif'],
            serif: ['"Playfair Display"', 'serif'],
            'zhi-mang': ['"Zhi Mang Xing"', 'cursive'],
          },
          colors: {
            slate: {
              900: '#0f172a',
              950: '#020617',
              400: '#94a3b8',
              300: '#cbd5e1',
              200: '#e2e8f0',
              100: '#f1f5f9',
            },
            sky: {
              400: '#7dd3fc',
              500: '#38bdf8',
              600: '#0ea5e9',
            }
          }
        }
      }
    }
  </script>

  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Noto Sans SC', sans-serif;
      background-color: #0f172a;
      color: white;
      line-height: 1.6;
      overflow-x: hidden;
      position: relative;
    }
    ::-webkit-scrollbar { width: 8px; }
    ::-webkit-scrollbar-track { background: #0f172a; }
    ::-webkit-scrollbar-thumb { background: #334155; border-radius: 4px; }
    ::-webkit-scrollbar-thumb:hover { background: #475569; }

    .reveal {
      opacity: 0;
      transform: translateY(30px);
      transition: all 0.8s ease-out;
    }
    .reveal.active {
      opacity: 1;
      transform: translateY(0);
    }
    .reveal-delay-100 { transition-delay: 0.1s; }
    .reveal-delay-200 { transition-delay: 0.2s; }
    .reveal-delay-300 { transition-delay: 0.3s; }

    .slide-in-left {
      opacity: 0;
      transform: translateX(-50px);
      transition: all 1s ease-out;
    }
    .slide-in-left.active {
      opacity: 1;
      transform: translateX(0);
    }

    .parallax-bg {
      position: fixed;
      top: 0; left: 0; width: 100%; height: 100%;
      z-index: -20;
      background-color: #0f172a;
      transform: scale(1.1);
      transition: transform 0.1s ease-out;
    }

    .section-title {
      font-family: 'Zhi Mang Xing', cursive;
      font-size: 5rem;
      margin-bottom: 2rem;
      color: #ffffff;
    }

    @media (max-width: 768px) {
      .section-title { font-size: 1.8rem; }
      .news-grid { grid-template-columns: 1fr !important; }
    }
  </style>
</head>
<body class="text-white selection:bg-sky-500 selection:text-slate-900">

  <div id="site-header"></div>

  <main>
    <section class="container mx-auto px-6 mb-16 flex items-center justify-end">
      <div class="max-w-2xl text-right">
        <h1 class="text-4xl md:text-6xl lg:text-7xl font-serif font-bold mb-2 text-white drop-shadow-[0_2px_4px_rgba(0,0,0,0.5)]">
          Campus <span class="text-sky-500 italic drop-shadow-[0_2px_4px_rgba(0,0,0,0.3)]">News</span>
        </h1>
        <p class="text-lg md:text-xl text-slate-100 font-light drop-shadow-[0_1px_3px_rgba(0,0,0,0.4)]">
          Updates, stories, and announcements from our vibrant academic community.
        </p>
      </div>
    </section>

    <section class="container mx-auto px-6 mb-12 reveal reveal-delay-100 active" id="filter-buttons">
  <div class="flex flex-wrap justify-end gap-4 w-full">
    <button data-category="all" class="px-6 py-2 rounded-full bg-sky-600 text-white text-sm font-bold uppercase tracking-widest shadow-lg shadow-sky-900/20">
      All Posts
    </button>
    <button data-category="academic" class="px-6 py-2 rounded-full bg-white/5 border border-white/10 hover:bg-white/10 hover:border-sky-500/30 text-slate-200 text-sm font-bold uppercase tracking-widest transition-all">
      Academic
    </button>
    <button data-category="events" class="px-6 py-2 rounded-full bg-white/5 border border-white/10 hover:bg-white/10 hover:border-sky-500/30 text-slate-200 text-sm font-bold uppercase tracking-widest transition-all">
      Events
    </button>
    <button data-category="student life" class="px-6 py-2 rounded-full bg-white/5 border border-white/10 hover:bg-white/10 hover:border-sky-500/30 text-slate-200 text-sm font-bold uppercase tracking-widest transition-all">
      Student Life
    </button>
  </div>
</section>

    <section class="container mx-auto px-6 mb-16 reveal reveal-delay-200 active">
      <div class="bg-white/5 backdrop-blur-md rounded-2xl overflow-hidden border border-white/10 hover:border-sky-500/30 transition-all group">
        <div class="grid md:grid-cols-2">
          <div class="h-64 md:h-auto overflow-hidden relative">
            <img src="https://picsum.photos/id/1/1200/800" alt="Featured News" class="w-full h-full object-cover transform group-hover:scale-105 transition-transform duration-700">
            <div class="absolute top-4 left-4 bg-sky-600 text-white text-xs font-bold px-3 py-1 rounded-sm uppercase tracking-widest z-10">Featured</div>
          </div>
          <div class="p-8 md:p-12 flex flex-col justify-center">
            <div class="flex items-center gap-2 mb-4 text-sm text-slate-300">
              <span>October 24, 2024</span>
              <span class="w-1 h-1 bg-sky-500 rounded-full"></span>
              <span class="text-sky-500 uppercase tracking-widest font-semibold">Global Exchange</span>
            </div>
            <h2 class="text-3xl md:text-4xl font-serif font-medium text-white mb-6 group-hover:text-sky-400 transition-colors">
              Global Cultural Exchange Program Launches with 20 Partner Universities
            </h2>
            <p class="text-slate-100 mb-8 font-light leading-relaxed">
              STIBA Tarumanagara Xinya welcomes students from partner universities worldwide.
            </p>
            <a href="#" class="inline-flex items-center text-sky-500 text-sm font-bold uppercase tracking-widest hover:text-sky-400 transition-colors group/link">
              Read Full Story
              <svg class="w-5 h-5 ml-2 transform group-hover/link:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path>
              </svg>
            </a>
          </div>
        </div>
      </div>
    </section>

    <section class="container mx-auto px-6">
      <div id="publicNewsContainer" class="grid md:grid-cols-2 lg:grid-cols-3 gap-8 news-grid">
         <p class="text-gray-400">Loading news...</p>
      </div>

      <div class="flex justify-center mt-16 gap-2 reveal">
        <button class="w-10 h-10 flex items-center justify-center rounded-full border border-white/20 hover:bg-white hover:text-slate-900 transition-colors disabled:opacity-50" disabled>
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M15 18l-6-6 6-6"/></svg>
        </button>
        <button class="w-10 h-10 flex items-center justify-center rounded-full bg-sky-600 text-white font-bold text-sm">1</button>
        <button class="w-10 h-10 flex items-center justify-center rounded-full border border-white/20 hover:bg-white hover:text-slate-900 transition-colors text-sm text-slate-200">2</button>
        <button class="w-10 h-10 flex items-center justify-center rounded-full border border-white/20 hover:bg-white hover:text-slate-900 transition-colors">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 18l6-6-6-6"/></svg>
        </button>
      </div>
    </section>
  </main>
<script>
  // 1. Load Header
  (async () => {
    try {
      const response = await fetch('header.html');
      const html = await response.text();
      document.getElementById('site-header').innerHTML = html;
    } catch (err) {
      console.error('Failed to load header.html:', err);
    }
  })();

  // 2. Scroll & Reveal
  document.addEventListener('DOMContentLoaded', () => {
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add('active');
          observer.unobserve(entry.target);
        }
      });
    }, { threshold: 0.15 });

    document.querySelectorAll('.reveal, .slide-in-left').forEach(el => observer.observe(el));
    setTimeout(() => {
      document.querySelectorAll('.reveal').forEach(el => {
        if (el.getBoundingClientRect().top < window.innerHeight) el.classList.add('active');
      });
    }, 100);
  });

  // 3. News Fetch + Filter
  let allArticles = [];

  async function fetchAndRenderNews() {
    const container = document.getElementById('publicNewsContainer');
    container.innerHTML = '<p class="text-gray-400 col-span-3">Loading news...</p>';

    try {
      const response = await fetch('http://localhost:5000/api/news');
      if (!response.ok) throw new Error(`HTTP ${response.status}`);
      
      allArticles = await response.json();
      renderArticles(allArticles);
    } catch (error) {
      console.error('Failed to fetch news:', error);
      container.innerHTML = `<p class="text-red-400 col-span-3 text-center">
        ❌ Failed to load news. Check:
        <br>- Is your backend running on <code>localhost:5000</code>?
        <br>- Are there CORS issues? (See Console/Network tab)
      </p>`;
    }
  }

  function renderArticles(articles) {
    const container = document.getElementById('publicNewsContainer');
    if (!articles || articles.length === 0) {
      container.innerHTML = '<p class="text-white text-center col-span-3">No news available.</p>';
      return;
    }

    const html = articles.map((article, index) => {
      const imgUrl = article.image_url 
        ? `http://localhost:5000${article.image_url}`
        : `https://picsum.photos/id/${20 + (index % 20)}/800/600`;

      const pubDate = new Date(article.published_date || article.created_at).toLocaleDateString('en-GB');

      return `
        <article class="group h-full">
          <div class="bg-white/5 backdrop-blur-md rounded-xl overflow-hidden border border-white/10 hover:border-sky-500/30 transition-all duration-500 hover:-translate-y-1 hover:shadow-xl hover:shadow-sky-900/10 h-full flex flex-col">
            <div class="h-48 overflow-hidden relative">
              <img src="${imgUrl}" alt="${article.title}" class="w-full h-full object-cover transform group-hover:scale-110 transition-transform duration-700">
              <div class="absolute top-4 left-4 bg-slate-900/80 backdrop-blur text-white text-xs font-bold px-3 py-1 rounded-sm uppercase tracking-widest">
                ${pubDate}
              </div>
            </div>
            <div class="p-6 flex-1 flex flex-col">
              <div class="text-sky-500 text-xs font-bold uppercase tracking-widest mb-2">
                ${article.category || 'Uncategorized'}
              </div>
              <h3 class="text-xl font-serif font-medium text-white mb-3 group-hover:text-sky-400 transition-colors line-clamp-2">
                ${article.title}
              </h3>
              <p class="text-slate-200 text-sm leading-relaxed mb-6 flex-1 line-clamp-3">
                ${article.summary || (article.content?.substring(0, 100) + '...')}
              </p>
              <a href="article.html?slug=${encodeURIComponent(article.slug || article.id)}" class="inline-flex items-center text-slate-300 hover:text-sky-400 text-xs font-bold uppercase tracking-widest transition-colors">
                Read More
              </a>
            </div>
          </div>
        </article>
      `;
    }).join('');

    container.innerHTML = html;
  }

  // 4. Attach Filter Logic — Safe & Non-breaking
  document.addEventListener('DOMContentLoaded', () => {
    // Fetch news on load
    fetchAndRenderNews();

    // Add filter listeners *after* DOM is ready
    document.addEventListener('click', (e) => {
      const btn = e.target.closest('button[data-category]');
      if (!btn || !allArticles.length) return;

      const category = btn.dataset.category.toLowerCase();

      // Update active button style
      document.querySelectorAll('#filter-buttons button').forEach(b => {
        b.classList.toggle('bg-sky-600', b === btn);
        b.classList.toggle('text-white', b === btn);
        if (b !== btn) {
          b.classList.remove('bg-sky-600', 'text-white');
          b.classList.add('bg-white/5', 'text-slate-200');
        }
      });

      // Filter
      if (category === 'all') {
        renderArticles(allArticles);
      } else {
        const filtered = allArticles.filter(a => 
          (a.category || '').toLowerCase() === category
        );
        renderArticles(filtered);
      }
    });
  });
</script>
</body>
</html>