<!DOCTYPE html>
<html lang="zh-CN" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Article - STIBA Tarumanagara Xinya</title>
  
  <!-- IMPORTANT: For production, install Tailwind locally. For development, CDN is okay. -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,600;0,700;1,400&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Zhi+Mang+Xing&display=swap" rel="stylesheet">

  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            serif: ['"Playfair Display"', 'serif'],
            sans: ['"Noto Sans SC"', 'sans-serif'],
            'zhi-mang': ['"Zhi Mang Xing"', 'cursive'],
          },
          colors: {
            slate: { 900: '#0f172a', 950: '#020617' },
            amber: { 400: '#fbbf24', 500: '#f59e0b', 600: '#d97706' },
            sky: { 400: '#7dd3fc', 500: '#38bdf8', 600: '#0ea5e9' }
          }
        }
      }
    }
  </script>

  <style>
    ::-webkit-scrollbar { width: 8px; }
    ::-webkit-scrollbar-track { background: #0f172a; }
    ::-webkit-scrollbar-thumb { background: #334155; border-radius: 4px; }
    ::-webkit-scrollbar-thumb:hover { background: #475569; }

    body { background-color: #0f172a; color: white; font-family: 'Noto Sans SC', sans-serif; overflow-x: hidden; }
    
    .reveal { opacity: 0; transform: translateY(30px); transition: all 0.8s ease-out; }
    .reveal.active { opacity: 1; transform: translateY(0); }
    .reveal-delay-100 { transition-delay: 0.1s; }
    .reveal-delay-200 { transition-delay: 0.2s; }
    
    /* Styling untuk konten dinamis */
    .dynamic-body p { margin-bottom: 1.5em; line-height: 1.8; color: #e2e8f0; font-weight: 300; }
    .dynamic-body h3 { font-family: 'Playfair Display', serif; font-size: 1.5rem; color: #38bdf8; margin-top: 2rem; margin-bottom: 1rem; font-weight: 600; }
    .dynamic-body blockquote { border-left: 4px solid #f59e0b; padding-left: 1.5rem; font-style: italic; color: #f8fafc; margin: 2rem 0; background: rgba(255,255,255,0.05); padding: 1.5rem; border-radius: 0 1rem 1rem 0; }
  </style>
</head>
<body class="text-white selection:bg-amber-500 selection:text-slate-900">

  <div id="site-header"></div>

  <main class="pb-24 relative z-10">
    
    <div class="container mx-auto px-6 mb-8 reveal active">
      <div class="flex flex-col md:flex-row md:items-center justify-between gap-6 mb-8 border-b border-white/10 pb-6">
        
        <a href="news.html" class="group inline-flex items-center gap-3 text-slate-300 hover:text-amber-400 transition-all duration-300">
          <div class="w-10 h-10 rounded-full border border-slate-600 group-hover:border-amber-400 flex items-center justify-center transition-colors bg-slate-900/50 backdrop-blur">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="transform group-hover:-translate-x-1 transition-transform"><path d="M19 12H5"/><path d="M12 19l-7-7 7-7"/></svg>
          </div>
          <div class="flex flex-col">
            <span class="uppercase tracking-widest text-xs font-bold text-slate-500 group-hover:text-amber-400/70">Return</span>
            <span class="font-serif text-lg leading-none">Back to News</span>
          </div>
        </a>

        <div class="flex items-center gap-2 text-sm text-gray-500 font-medium">
          <a href="index.html" class="hover:text-amber-500 transition-colors">Home</a>
          <span>/</span>
          <a href="news.html" class="hover:text-amber-500 transition-colors">News</a>
          <span>/</span>
          <span class="text-sky-400">Article Detail</span>
        </div>
      </div>
      
      <div class="max-w-4xl" id="article-header">
        <div class="animate-pulse space-y-4">
            <div class="h-4 bg-slate-800 rounded w-1/4"></div>
            <div class="h-12 bg-slate-800 rounded w-3/4"></div>
        </div>
      </div>
    </div>

    <div class="container mx-auto px-6 mb-16 reveal reveal-delay-100 active">
      <div class="w-full h-[400px] md:h-[600px] rounded-2xl overflow-hidden shadow-2xl shadow-sky-900/20 relative border border-white/10 group">
        <img id="main-image" src="" alt="Loading..." class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-105 opacity-0">
        <div class="absolute inset-0 bg-gradient-to-t from-slate-900 via-transparent to-transparent opacity-80"></div>
      </div>
    </div>

    <div class="container mx-auto px-6">
      <div class="grid lg:grid-cols-12 gap-12">
        
        <div class="lg:col-span-8 article-content reveal reveal-delay-200 active">
          <div class="bg-slate-900/60 backdrop-blur-md p-8 md:p-10 rounded-2xl border border-white/10 shadow-2xl min-h-[300px]">
            
            <div id="article-body" class="dynamic-body">
                <div class="flex items-center justify-center h-full text-slate-500 animate-pulse">
                    Loading article content...
                </div>
            </div>

            <div class="mt-16 pt-8 border-t border-white/10">
                <h4 class="text-sm uppercase tracking-widest text-sky-400 mb-4 font-bold flex items-center gap-2">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"></path></svg>
                Category
                </h4>
                <div class="flex flex-wrap gap-2" id="article-tags">
                    <!-- Tags will be populated here -->
                </div>
            </div>

          </div> 
        </div>

        <aside class="lg:col-span-4 space-y-8 reveal reveal-delay-200 active">
          <div class="bg-slate-900/60 backdrop-blur-md p-8 rounded-2xl border border-white/10 shadow-xl">
            <h4 class="text-xs font-bold uppercase tracking-widest text-amber-500 mb-6 border-b border-white/5 pb-2">Written By</h4>
            <div class="flex items-center gap-4 mb-4">
              <div class="w-16 h-16 rounded-full bg-slate-700 flex items-center justify-center text-2xl">✍️</div>
              <div>
                <h5 class="font-serif text-xl font-medium text-white" id="author-name">Admin</h5>
                <p class="text-xs text-sky-400 uppercase tracking-wide">Contributor</p>
              </div>
            </div>
          </div>

          <div class="bg-slate-900/60 backdrop-blur-md p-8 rounded-2xl border border-white/10 shadow-xl">
            <h4 class="text-xs font-bold uppercase tracking-widest text-amber-500 mb-6 border-b border-white/5 pb-2">Share Article</h4>
            <div class="flex gap-3">
              <button class="flex-1 py-3 bg-[#1DA1F2]/10 hover:bg-[#1DA1F2] text-[#1DA1F2] hover:text-white rounded-lg flex items-center justify-center transition-all border border-[#1DA1F2]/20"><svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24"><path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"/></svg></button>
              <button class="flex-1 py-3 bg-[#0077b5]/10 hover:bg-[#0077b5] text-[#0077b5] hover:text-white rounded-lg flex items-center justify-center transition-all border border-[#0077b5]/20"><svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/></svg></button>
            </div>
          </div>
        </aside>
      </div>
    </div>
  </main>

  <div id="site-footer"></div>

  <script>
    // 1. Load Header & Footer
    (async () => {
      try {
        const hRes = await fetch('header.html');
        if(hRes.ok) document.getElementById('site-header').innerHTML = await hRes.text();
        const fRes = await fetch('footer.html');
        if(fRes.ok) document.getElementById('site-footer').innerHTML = await fRes.text();

        // Parallax - Note: 'parallax-bg' ID doesn't exist in this HTML, so this does nothing.
        // window.addEventListener('scroll', () => {
        //   const parallax = document.getElementById('parallax-bg');
        //   if (parallax) parallax.style.transform = `scale(1.1) translateY(${window.scrollY * 0.2}px)`;
        // });
      } catch (err) {
          console.error("Failed to load header/footer:", err);
      }
    })();

    // 2. FETCH & DISPLAY DATA (The Logic)
    document.addEventListener('DOMContentLoaded', async () => {
        const urlParams = new URLSearchParams(window.location.search);
        const slug = urlParams.get('slug');

        if (!slug) {
            console.error("No 'slug' parameter found in URL.");
            document.getElementById('article-body').innerHTML = `<p class="text-red-400 text-center py-10">No article slug provided in URL.</p>`;
            // Optionally redirect to news.html
            // window.location.href = 'news.html';
            return;
        }

        console.log("Attempting to fetch article with slug:", slug); // Debug log

        try {
            // Fetch Data using slug - Ensure this matches your backend route
            // FIXED: Use 'slug' variable instead of 'id'
            const res = await fetch(`http://localhost:5000/api/news/${slug}`);
            console.log("Fetch response status:", res.status); // Debug log
            if(!res.ok) {
                // Check if it's a 404 specifically
                if (res.status === 404) {
                    throw new Error(`Article with slug '${slug}' not found.`);
                } else {
                    throw new Error(`HTTP error! status: ${res.status}`);
                }
            }
            const data = await res.json();
            console.log("Fetched article data:", data); // Debug log

            // 1. Update Header
            document.getElementById('article-header').innerHTML = `
                <div class="flex items-center gap-4 mb-6">
                  <span class="px-3 py-1 bg-amber-500/10 text-amber-400 text-xs font-bold uppercase tracking-widest rounded-full border border-amber-500/20">${data.category}</span>
                  <span class="text-gray-400 text-sm flex items-center gap-2">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                    ${new Date(data.published_date || data.created_at).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}
                  </span>
                </div>
                <h1 class="text-4xl md:text-5xl lg:text-6xl font-serif font-bold text-white mb-8 leading-tight drop-shadow-lg">${data.title}</h1>
            `;

            // 2. Update Image
            const img = document.getElementById('main-image');
            if(data.image_url) {
                img.src = `http://localhost:5000${data.image_url}`;
                img.onload = () => img.classList.remove('opacity-0'); // Fade in
                img.onerror = () => {
                    console.warn("Failed to load image:", img.src);
                    img.src = `https://picsum.photos/1200/600`; // Fallback on error
                    img.classList.remove('opacity-0');
                };
            } else {
                img.src = `https://picsum.photos/1200/600`; // Fallback if no image_url
                img.classList.remove('opacity-0');
            }

            // 3. Update Content (Handle Newlines)
            const contentBox = document.getElementById('article-body');
            
            // CONVERT PLAIN TEXT TO PARAGRAPHS
            // Logic: Split by newline, filter empty, wrap in <p>
            const formattedContent = data.content
                .split('\n')
                .filter(p => p.trim() !== '')
                .map(p => `<p>${p}</p>`)
                .join('');

            contentBox.innerHTML = formattedContent;

            // 4. Update Sidebar Info
            document.getElementById('author-name').textContent = data.author_name || 'Admin';
            document.getElementById('article-tags').innerHTML = `
                <a href="#" class="px-4 py-2 bg-slate-800 hover:bg-sky-600 text-slate-300 hover:text-white text-sm rounded-full border border-slate-700 hover:border-sky-500 transition-all">${data.category}</a>
                <a href="#" class="px-4 py-2 bg-slate-800 hover:bg-sky-600 text-slate-300 hover:text-white text-sm rounded-full border border-slate-700 hover:border-sky-500 transition-all">Latest</a>
            `;

        } catch (error) {
            console.error("Error loading article:", error);
            document.getElementById('article-body').innerHTML = `<p class="text-red-400 text-center py-10">Error loading article: ${error.message}</p>`;
        }

        // Trigger animations
        setTimeout(() => {
            document.querySelectorAll('.reveal').forEach(el => el.classList.add('active'));
        }, 100);
    });
  </script>

</body>
</html>